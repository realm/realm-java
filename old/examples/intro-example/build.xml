<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<project basedir="." default="build" name="examples">

    <property name="debuglevel" value="source,lines,vars"/>
	<property name="source" value="1.6" />
	<property name="target" value="1.6" />
	<property name="srcdir" value="src" />
	<property name="gendir" value="generated" />
	<property name="bindir" value="bin" />
	<property name="libpath" value="../../lib" />
    <property name="jnipath" value="${libpath}" />
	<property name="libpath-sqlite" value="../lib-sqlite" />

    <path id="build-classpath">
        <pathelement location="${libpath}/realm.jar"/>
        <pathelement location="${libpath-sqlite}/sqlite4java.jar"/>
    </path>

    <path id="samples-classpath">
        <pathelement location="${bindir}"/>
        <pathelement location="${libpath}/realm.jar"/>
        <pathelement location="${libpath-sqlite}/sqlite4java.jar"/>
    </path>

    <target name="init">
        <mkdir dir="${gendir}"/>
        <mkdir dir="${bindir}"/>
        <copy includeemptydirs="false" todir="${bindir}">
            <fileset dir="src">
                <exclude name="**/*.java"/>
            </fileset>
        </copy>
    </target>

    <target depends="init" name="build-project">
        <echo message="${ant.project.name}: ${ant.file}"/>
        <javac debug="true" debuglevel="${debuglevel}" destdir="${bindir}" source="${source}" target="${target}" includeantruntime="false">
            <src path="${srcdir}"/>
            <src path="${gendir}"/>
            <classpath refid="build-classpath"/>
        </javac>
    </target>

    <target name="clean">
        <delete dir="${gendir}"/>
        <delete dir="${bindir}"/>
    </target>

    <target depends="clean,generate-sources,build-project" name="build"/>

	<target name="generate-sources">
		<echo message="${ant.project.name}: ${ant.file}" />
		<delete dir="${gendir}"/>
		<mkdir dir="${gendir}"/>
		<javac source="${source}" target="${target}" srcdir="${srcdir}" includeantruntime="false">
			<classpath refid="build-classpath"/>
			<compilerarg value="-processor" />
			<compilerarg value="io.realm.generator.CodeGenProcessor" />
			<compilerarg value="-processorpath" />
			<compilerarg value="${libpath}/realm-devkit.jar" />
			<compilerarg value="-s" />
			<compilerarg value="${gendir}" />
			<compilerarg value="-proc:only" />
		</javac>
	</target>

    <target depends="build" name="tutorial">
        <java classname="io.realm.examples.tutorial.Tutorial" failonerror="true" fork="yes">
<!--
            <env key="LD_LIBRARY_PATH" path="${libpath}"/>
            <env key="DYLD_LIBRARY_PATH" path="${libpath}"/>
-->
            <sysproperty key="java.library.path" path="${jnipath}"/>
            <classpath refid="samples-classpath"/>
        </java>
    </target>

    <target depends="build" name="showcase">
        <java classname="io.realm.examples.showcase.Showcase" failonerror="true" fork="yes">
<!--
            <env key="LD_LIBRARY_PATH" path="${libpath}"/>
            <env key="DYLD_LIBRARY_PATH" path="${libpath}"/>
-->
            <sysproperty key="java.library.path" path="${jnipath}"/>
            <classpath refid="samples-classpath"/>
        </java>
    </target>

    <target depends="build" name="quickbenchmark">
        <java classname="io.realm.examples.quickbenchmark.QuickBenchmark" failonerror="true" fork="yes">
<!--
            <env key="LD_LIBRARY_PATH" path="${libpath}"/>
            <env key="DYLD_LIBRARY_PATH" path="${libpath}"/>
-->
            <sysproperty key="java.library.path" path="${jnipath}"/>
            <classpath refid="samples-classpath"/>
        </java>
    </target>

    <target depends="build" name="performance">
        <java classname="io.realm.examples.performance.Performance" failonerror="true" fork="yes">
<!--
            <env key="LD_LIBRARY_PATH" path="${libpath}"/>
            <env key="DYLD_LIBRARY_PATH" path="${libpath}"/>
-->
            <sysproperty key="java.library.path" path="${jnipath}"/>
            <classpath refid="samples-classpath"/>
        </java>
    </target>

    <target depends="tutorial,showcase,quickbenchmark,performance" name="runall">
    </target>

</project>
