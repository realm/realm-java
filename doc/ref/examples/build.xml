<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<project basedir="." default="build" name="examples">

    <property name="debuglevel" value="source,lines,vars"/>
	<property name="source" value="1.6" />
	<property name="target" value="1.6" />
	<property name="srcdir" value="src" />
	<property name="gendir" value="generated" />
	<property name="bindir" value="bin" />
	<property name="libpath" value="../../../lib" />

    <path id="build-classpath">
        <pathelement location="${libpath}/realm.jar"/>
    </path>

    <path id="samples-classpath">
        <pathelement location="${bindir}"/>
        <pathelement location="${libpath}/realm.jar"/>
    </path>

    <target name="init">
        <mkdir dir="${gendir}"/>
        <mkdir dir="${bindir}"/>
        <copy includeemptydirs="false" todir="${bindir}">
            <fileset dir="src">
                <exclude name="**/*.java"/>
            </fileset>
        </copy>
    </target>

    <target depends="init" name="build-project">
        <echo message="${ant.project.name}: ${ant.file}"/>
        <javac debug="true" debuglevel="${debuglevel}" destdir="${bindir}" source="${source}" target="${target}" includeantruntime="false">
            <src path="${srcdir}"/>
            <src path="${gendir}"/>
            <classpath refid="build-classpath"/>
        </javac>
    </target>

    <target name="clean">
        <delete dir="${gendir}"/>
        <delete dir="${bindir}"/>
    </target>

    <target depends="clean,generate-sources,build-project" name="build"/>

	<target name="generate-sources">
		<echo message="${ant.project.name}: ${ant.file}" />
		<delete dir="${gendir}"/>
		<mkdir dir="${gendir}"/>
		<javac source="${source}" target="${target}" srcdir="${srcdir}" includeantruntime="false">
			<classpath refid="build-classpath"/>
			<compilerarg value="-processor" />
			<compilerarg value="com.realm.generator.CodeGenProcessor" />
			<compilerarg value="-processorpath" />
			<compilerarg value="${libpath}/realm-devkit.jar" />
			<compilerarg value="-s" />
			<compilerarg value="${gendir}" />
			<compilerarg value="-proc:only" />
		</javac>
	</target>

    <target depends="build" name="refdoc">
        <java classname="com.realm.refdoc.RefDocExamples" failonerror="true" fork="yes">
            <sysproperty key="java.library.path" path="${libpath}"/>
            <classpath refid="samples-classpath"/>
        </java>
    </target>

</project>
