<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<project basedir="." default="build" name="examples">

    <property name="debuglevel" value="source,lines,vars"/>
	<property name="source" value="1.6" />
	<property name="target" value="1.6" />
	<property name="srcdir" value="src" />
	<property name="gendir" value="generated" />
	<property name="bindir" value="bin" />
	<property name="libpath" value=".." />

    <path id="build-classpath">
        <pathelement location="${libpath}/lib/tightdb.jar"/>
        <pathelement location="${libpath}/lib-sqlite/sqlite4java.jar"/>
        <pathelement location="${libpath}/lib-orientdb/orientdb-core-1.3.0.jar"/>
        <pathelement location="${libpath}/lib-orientdb/orient-commons-1.3.0.jar"/>
    </path>

    <path id="samples-classpath">
        <pathelement location="${bindir}"/>
        <pathelement location="${libpath}/lib/tightdb.jar"/>
        <pathelement location="${libpath}/lib-sqlite/sqlite4java.jar"/>
        <pathelement location="${libpath}/lib-orientdb/orientdb-core-1.3.0.jar"/>
        <pathelement location="${libpath}/lib-orientdb/orient-commons-1.3.0.jar"/>
    </path>

    <target name="init">
        <mkdir dir="${gendir}"/>
        <mkdir dir="${bindir}"/>
        <copy includeemptydirs="false" todir="${bindir}">
            <fileset dir="src">
                <exclude name="**/*.java"/>
            </fileset>
        </copy>
    </target>

    <target depends="init" name="build-project">
        <echo message="${ant.project.name}: ${ant.file}"/>
        <javac debug="true" debuglevel="${debuglevel}" destdir="${bindir}" source="${source}" target="${target}" includeantruntime="false">
            <src path="${srcdir}"/>
            <src path="${gendir}"/>
            <classpath refid="build-classpath"/>
        </javac>
    </target>

    <target name="clean">
        <delete dir="${gendir}"/>
        <delete dir="${bindir}"/>
    </target>

    <target depends="clean,generate-sources,build-project" name="build"/>

	<target name="generate-sources">
		<echo message="${ant.project.name}: ${ant.file}" />
		<delete dir="${gendir}"/>
		<mkdir dir="${gendir}"/>
		<javac source="${source}" target="${target}" srcdir="${srcdir}" includeantruntime="false">
			<classpath refid="build-classpath"/>
			<compilerarg value="-processor" />
			<compilerarg value="com.tightdb.generator.CodeGenProcessor" />
			<compilerarg value="-processorpath" />
			<compilerarg value="${libpath}/lib/tightdb-devkit.jar" />
			<compilerarg value="-s" />
			<compilerarg value="${gendir}" />
			<compilerarg value="-proc:only" />
		</javac>
	</target>

    <target name="tutorial">
        <java classname="com.tightdb.examples.tutorial.tutorial" failonerror="true" fork="yes">
            <env key="LD_LIBRARY_PATH" path="${libpath}/lib"/>
            <env key="DYLD_LIBRARY_PATH" path="${libpath}/lib"/> <!-- Darwin -->
            <sysproperty key="java.library.path" path="${libpath}/lib"/>
            <classpath refid="samples-classpath"/>
        </java>
    </target>

    <target name="showcase">
        <java classname="com.tightdb.examples.showcase.Showcase" failonerror="true" fork="yes">
            <env key="LD_LIBRARY_PATH" path="${libpath}/lib"/>
            <env key="DYLD_LIBRARY_PATH" path="${libpath}/lib"/> <!-- Darwin -->
            <sysproperty key="java.library.path" path="${libpath}/lib"/>
            <classpath refid="samples-classpath"/>
        </java>
    </target>

    <target name="performance">
        <java classname="com.tightdb.examples.performance.Performance" failonerror="true" fork="yes">
            <env key="LD_LIBRARY_PATH" path="${libpath}/lib"/>
            <env key="DYLD_LIBRARY_PATH" path="${libpath}/lib"/> <!-- Darwin -->
            <sysproperty key="java.library.path" path="${libpath}/lib"/>
            <classpath refid="samples-classpath"/>
        </java>
    </target>

</project>
